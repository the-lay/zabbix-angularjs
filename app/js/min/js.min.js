/*! angular 2013-04-29 */
"use strict";function dateConverter(e,t){var r=new Date(1e3*e),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=r.getHours(),l=r.getMinutes(),i=r.getSeconds();return 0===n&&(n="0"+n),10>l&&(l="0"+l),10>i&&(i="0"+i),t?"time"===t?n+":"+l+":"+i:void 0:r.getDate()+" "+o[r.getMonth()]+" "+r.getFullYear()+", "+n+":"+l+":"+i}function timeConverter(){var e=new Date,t=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return 0===t&&(t="0"+t),10>r&&(r="0"+r),10>o&&(o="0"+o),t+":"+r+":"+o}var api_url="http://zabbixcm02.internal.corp/zabbix/api_jsonrpc.php",zabbix_url="http://zabbixcm02.internal.corp/zabbix",triggerUpdateInterval=3e4,hostgroupUpdateInterval=6e5,app=angular.module("zabbix",["LocalStorageModule","SharedServices"]).config(function(e,t){e.when("/",{controller:overviewController,templateUrl:"views/overview.html",title_prefix:"Home"}).when("/overview",{controller:overviewController,templateUrl:"views/overview.html",title_prefix:"Home"}).when("/servers",{controller:serversController,templateUrl:"views/servers.html",title_prefix:"Servers"}).when("/servers/:serverId",{controller:serversDetailsController,templateUrl:"views/serverDetails.html",title_prefix:"Server"}).when("/project/:projectId",{controller:projectController,templateUrl:"views/project.html",title_prefix:"Project"}).when("/dashboard",{controller:dashboardController,templateUrl:"views/dashboard.html",title_prefix:"Dashboard"}).when("/search/:searchString",{controller:searchController,templateUrl:"views/search.html",title_prefix:"Search"}).when("/login").when("/logout",{controller:logoutController,title_prefix:"Logout",templateUrl:"views/logout.html"}).otherwise({redirectTo:"/"}),t.html5Mode(!1)}).directive("onFinishRender",function(e){return{restrict:"A",link:function(t,r,o){t.$last===!0&&e(function(){t.$emit(o.onFinishRender)})}}});app.run(function(e,t,r,o,n){!e.loggedIn&&n.get("auth")&&(e.auth=n.get("auth"),e.auth_id=n.get("auth_id"),e.loggedIn=!0,r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,auth:e.auth,method:"host.get",params:{monitored_hosts:!0,output:["name"],sortfield:"name"}}).success(function(t){e.serversOnline=t.result})),e.page_title="Home - Zabbix",e.$on("$routeChangeSuccess",function(){return e.loggedIn||o.path("/login/"),e.page_title=t.current&&t.current.$route&&t.current.$route.title_prefix?t.current.$route.title_prefix+" - Zabbix":"Zabbix","/dashboard"!==o.path()?(e.fullscreen="",void 0):void 0})}),angular.module("SharedServices",[]).config(function(e){e.responseInterceptors.push("myHttpInterceptor");var t=function(e){return $("#loading").show(),e};e.defaults.transformRequest.push(t)}).factory("myHttpInterceptor",function(e){return function(t){return t.then(function(e){return $("#loading").hide(),e},function(t){return $("#loading").hide(),e.reject(t)})}});
/*! angular 2013-04-29 */
"use strict";function loginController(e,t,r,o,s){$("#inputName").focus(),e.login=function(){r.auth_id=Date.now(),s.add("auth_id",r.auth_id),t.post(api_url,{jsonrpc:"2.0",method:"user.login",auth:r.auth,params:{user:e.inputName,password:e.inputPassword},id:r.auth_id}).success(function(n){n.error?(e.error=n.error,$("#inputName").focus()):(s.add("auth",n.result),r.auth=n.result,r.loggedIn=!0,t.post(api_url,{jsonrpc:"2.0",id:r.auth_id,auth:r.auth,method:"host.get",params:{output:["name"],sortfield:"name"}}).success(function(e){r.serversOnline=e.result,o.path("/")}))})}}function logoutController(e,t,r,o){t.loggedIn?r.post(api_url,{jsonrpc:"2.0",id:t.auth_id,auth:t.auth,method:"user.logout",params:{}}).success(function(){t.loggedIn=!1,t.auth=null,t.auth_id=null,e.clearAll(),e.cookie.clearAll(),o.path("/login")}):o.path("/login")}function menuController(e,t){$(".nav-collapse a").click(function(){$("#collapsingBtn").is(":visible")&&$(".nav-collapse").collapse("toggle")}),e.findServer=function(){e.searchQuery&&t.path("/search/"+e.searchQuery),e.searchQuery=""}}function overviewController(e,t,r,o){if(e.loggedIn){t.groupErrorsPluralize={0:" ",one:"{} error!",other:"{} errors!"},t.triggerSeverity=["Fine","Information","Warning","Average","High","Disaster"];var s=r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,auth:e.auth,method:"hostgroup.get",params:{output:["groupid","name"],sortfield:"name",real_hosts:!0},filter:{name:"project"}}),n=r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,auth:e.auth,method:"trigger.get",params:{selectGroups:"refer",expandDescription:!0,expandData:!0,only_true:!0,sortfield:"lastchange",filter:{value:1},skipDependent:!0,monitored:!0,output:["triggerid","priority","lastchange","description"]}}).success(function(e){for(var t=0;e.result.length>t;t++)e.result[t].lastchange_words=dateConverter(e.result[t].lastchange)});o.all([s,n]).then(function(e){function r(e){for(var t=o.defer(),r=e.length-1;r>=0;r--)e[r].lastchange=0,e[r].lastchange_words="",e[r].errors=0,e[r].errors_level=0,a[e[r].groupid]=[];return t.resolve(),t.promise}var s=e[0].data.result,n=e[1].data.result,a={},i=r(s);i.then(function(){for(var e=0;s.length>e;e++)for(var r=0;n.length>r;r++)n[r].groups[0].groupid===s[e].groupid&&(s[e].errors+=1,a[s[e].groupid].push(n[r]),n[r].lastchange>s[e].lastchange&&(s[e].lastchange=n[r].lastchange,s[e].lastchange_words=dateConverter(n[r].lastchange)),n[r].priority>s[e].errors_level&&(s[e].errors_level=n[r].priority));t.serverGroups=s,t.triggerDetails=a})})}}function serversController(e,t,r){e.loggedIn&&r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,auth:e.auth,method:"host.get",params:{monitored_hosts:!0,output:["name","available","hostid","host"]}}).success(function(e){t.hostsData=e.result}),$("#filterInput").focus()}function serversDetailsController(e,t,r,o,s){o.serverId||s.path("/"),e.loggedIn&&r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,auth:e.auth,method:"host.get",params:{selectInventory:!0,selectItems:["name","lastvalue","units","itemid","lastclock"],output:"extend",hostids:o.serverId}}).success(function(e){if(t.inventoryData=e.result[0].inventory,t.serverName=e.result[0].name,t.zabbix_url=zabbix_url,t.hostId=o.serverId,t.itemsData=e.result[0].items)for(var r=t.itemsData.length-1;r>=0;r--)t.itemsData[r].lastclock=dateConverter(t.itemsData[r].lastclock,"time")})}function projectController(e,t,r,o,s){o.projectId||s.path("/"),e.loggedIn&&r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,method:"hostgroup.get",auth:e.auth,params:{groupids:o.projectId,output:["groupid","name"],sortfield:"name",selectHosts:["hostid","available","host","status","name"],real_hosts:!0,monitored_hosts:!0}}).success(function(e){t.hostgroupData=e.result[0]}),$("#filterInput").focus()}function dashboardController(e,t,r,o,s){function n(){return $(".server").tooltip("destroy").removeClass("error1 error2 error3 error4 error5"),!0}function a(e){for(var t=e.length-1;t>=0;t--)$("#"+e[t].hosts[0].hostid).tooltip({title:e[t].description}).addClass("error"+e[t].priority)}r.fullscreen="padding-left:2px; padding-right:2px;",e.selectedGroups={};var i=!0,l=!0;(function u(){return"/dashboard"!==o.path()?(r.fullscreen="",void 0):(t.post(api_url,{jsonrpc:"2.0",id:r.auth_id,auth:r.auth,method:"hostgroup.get",params:{real_hosts:!0,monitored_hosts:!0,output:["groupid","name"],selectHosts:["hostid","available","name","host","status"],sortfield:"name"}}).success(function(t){if(e.hostgroupsData=t.result,null===s.get("selectedGroups"))for(var r=t.result.length-1;r>=0;r--)e.selectedGroups[t.result[r].groupid]=!0,s.add("selectedGroups",JSON.stringify(e.selectedGroups));else e.selectedGroups=JSON.parse(s.get("selectedGroups"))}),setTimeout(u,hostgroupUpdateInterval),void 0)})(),function c(){return"/dashboard"!==o.path()?(r.fullscreen="",void 0):(t.post(api_url,{jsonrpc:"2.0",id:r.auth_id,auth:r.auth,method:"trigger.get",params:{expandDescription:!0,expandData:!0,sortfield:"priority",selectGroups:"refer",selectHosts:"refer",filter:{value:1},skipDependent:!0,monitored:!0,only_true:!0,output:["description","lastchange","priority","triggerid"]}}).success(function(t){e.triggersData=t.result,e.lastUpdated=timeConverter((new Date).getTime()),i?e.$on("serversRenderingFinished",function(){i&&(n(t.result,"firstTime")&&a(t.result,"firstTime"),i=!1)}):n(t.result,"NOT firstTime")&&a(t.result,"NOT firstTime"),e.$on("triggersRenderingFinished",function(){$('div[id^="notification-"]').hover(function(){$("#"+$(this).attr("id").substring(13)).addClass("zoomUp")},function(){$("#"+$(this).attr("id").substring(13)).removeClass("zoomUp")})})}),setTimeout(c,triggerUpdateInterval),void 0)}(),e.selectGroup=function(t){e.selectedGroups[t]===!0?(e.selectedGroups[t]=!1,s.add("selectedGroups",JSON.stringify(e.selectedGroups))):(e.selectedGroups[t]=!0,s.add("selectedGroups",JSON.stringify(e.selectedGroups)))},e.toggleGroupSelector=function(){$("#groups").animate({height:"toggle"},"slow"),l?(l=!1,e.groupSelectorShown="Show"):(l=!0,e.groupSelectorShown="Hide")}}function searchController(e,t,r,o,s){if(t.searchPhrase=o.searchString,o.searchString||s.path("/"),$("#serverSearch").blur(),e.loggedIn){for(var n=e.serversOnline.length-1;n>=0;n--)e.serversOnline[n].name===o.searchString&&s.path("/servers/"+e.serversOnline[n].hostid);r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,method:"host.get",auth:e.auth,params:{monitored_hosts:!0,output:["name","hostid"],search:{name:o.searchString},sortfield:"name"}}).success(function(e){t.hostsData=e.result}),r.post(api_url,{jsonrpc:"2.0",id:e.auth_id,method:"hostgroup.get",auth:e.auth,params:{output:["groupid","name"],sortfield:"name",real_hosts:!0,search:{name:o.searchString}}}).success(function(e){t.groupsData=e.result})}}
/*! angular 2013-04-29 */
"use strict";var angularLocalStorage=angular.module("LocalStorageModule",[]);angularLocalStorage.constant("prefix","ls"),angularLocalStorage.constant("cookie",{expiry:30,path:"/"}),angularLocalStorage.service("localStorageService",["$rootScope","prefix","cookie",function(e,t,r){"."!==t.substr(-1)&&(t=t?t+".":"");var o=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.Description),!1}},n=function(r,n){if(!o())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;if(!n&&0!==n&&""!==n)return!1;try{localStorage.setItem(t+r,n)}catch(a){return e.$broadcast("LocalStorageModule.notification.error",a.Description),!1}return!0},a=function(r){if(!o())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var n=localStorage.getItem(t+r);return n?n:null},i=function(r){if(!o())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;try{localStorage.removeItem(t+r)}catch(n){return e.$broadcast("LocalStorageModule.notification.error",n.Description),!1}return!0},s=function(){if(!o())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var r=t.length;for(var n in localStorage)if(n.substr(0,r)===t)try{i(n.substr(r))}catch(a){return e.$broadcast("LocalStorageModule.notification.error",a.Description),!1}return!0},l=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.Description),!1}},u=function(o,n){if(n===void 0)return!1;if(!l())return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var a="",i=new Date;null===n&&(r.expiry=-1,n=""),0!==r.expiry&&(i.setTime(i.getTime()+1e3*60*60*24*r.expiry),a="; expires="+i.toGMTString()),document.cookie=t+o+"="+encodeURIComponent(n)+a+"; path="+r.path}catch(s){return e.$broadcast("LocalStorageModule.notification.error",s.Description),!1}return!0},c=function(r){if(!l())return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=document.cookie.split(";"),n=0;o.length>n;n++){for(var a=o[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t+r+"="))return decodeURIComponent(a.substring(t.length+r.length+1,a.length))}return null},d=function(e){u(e,null)},p=function(){for(var e=null,r=t.length,o=document.cookie.split(";"),n=0;o.length>n;n++){for(e=o[n];" "==e.charAt(0);)e=e.substring(1,e.length);key=e.substring(r,e.indexOf("=")),d(key)}};return{isSupported:o,add:n,get:a,remove:i,clearAll:s,cookie:{add:u,get:c,remove:d,clearAll:p}}}]);